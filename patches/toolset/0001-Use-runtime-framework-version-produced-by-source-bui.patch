From 5e66fc7b9129d47481dd635a87c2a3dda2f24431 Mon Sep 17 00:00:00 2001
From: Chris Rummel <crummel@microsoft.com>
Date: Wed, 7 Nov 2018 00:55:00 -0600
Subject: [PATCH] Use runtime framework version produced by source-build

---
 src/redist/redist.csproj             | 4 +++-
 src/tool_cli/tool_cli.csproj         | 2 ++
 src/tool_fsharp/tool_fsc.csproj      | 1 +
 src/tool_msbuild/tool_msbuild.csproj | 3 +++
 src/tool_nuget/tool_nuget.csproj     | 4 +++-
 5 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/src/redist/redist.csproj b/src/redist/redist.csproj
index 0d64f6d4b..31dd17099 100644
--- a/src/redist/redist.csproj
+++ b/src/redist/redist.csproj
@@ -1,6 +1,8 @@
 ﻿<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0">
   <PropertyGroup>
-    <TargetFramework>$(ToolsetTargetFramework)</TargetFramework>
+    <VersionPrefix>$(CliVersionPrefix)</VersionPrefix>
+    <TargetFramework>$(CliTargetFramework)</TargetFramework>
+    <RuntimeFrameworkVersion>3.0.0-preview1-27023-03</RuntimeFrameworkVersion>
     <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
     <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
     <AssetTargetFallback>dotnet5.4</AssetTargetFallback>
diff --git a/src/tool_cli/tool_cli.csproj b/src/tool_cli/tool_cli.csproj
index 4fcb9a995..04a65dbf0 100644
--- a/src/tool_cli/tool_cli.csproj
+++ b/src/tool_cli/tool_cli.csproj
@@ -1,7 +1,9 @@
 <Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
 
   <PropertyGroup>
+    <VersionPrefix>$(CliVersionPrefix)</VersionPrefix>
     <TargetFramework>$(ToolsetTargetFramework)</TargetFramework>
+    <RuntimeFrameworkVersion>3.0.0-preview1-27023-03</RuntimeFrameworkVersion>
     <GenerateRuntimeConfigurationFiles>false</GenerateRuntimeConfigurationFiles>
     <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
     <AssetTargetFallback>dotnet5.4</AssetTargetFallback>
diff --git a/src/tool_fsharp/tool_fsc.csproj b/src/tool_fsharp/tool_fsc.csproj
index 6decbdd8a..5fa505396 100644
--- a/src/tool_fsharp/tool_fsc.csproj
+++ b/src/tool_fsharp/tool_fsc.csproj
@@ -1,6 +1,7 @@
 ﻿<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
   <PropertyGroup>
     <TargetFramework>$(ToolsetTargetFramework)</TargetFramework>
+    <RuntimeFrameworkVersion>3.0.0-preview1-27023-03</RuntimeFrameworkVersion>
     <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
   </PropertyGroup>
   
diff --git a/src/tool_msbuild/tool_msbuild.csproj b/src/tool_msbuild/tool_msbuild.csproj
index 2e6609437..25f743e77 100644
--- a/src/tool_msbuild/tool_msbuild.csproj
+++ b/src/tool_msbuild/tool_msbuild.csproj
@@ -1,7 +1,10 @@
 ﻿<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
 
   <PropertyGroup>
+    <VersionPrefix>$(CliVersionPrefix)</VersionPrefix>
     <TargetFramework>$(ToolsetTargetFramework)</TargetFramework>
+    <TargetFramework>$(CliTargetFramework)</TargetFramework>
+    <RuntimeFrameworkVersion>3.0.0-preview1-27023-03</RuntimeFrameworkVersion>
     <GenerateRuntimeConfigurationFiles>false</GenerateRuntimeConfigurationFiles>
     <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
   </PropertyGroup>
diff --git a/src/tool_nuget/tool_nuget.csproj b/src/tool_nuget/tool_nuget.csproj
index c240e6a2e..fc83adf72 100644
--- a/src/tool_nuget/tool_nuget.csproj
+++ b/src/tool_nuget/tool_nuget.csproj
@@ -1,7 +1,9 @@
 ﻿<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
 
   <PropertyGroup>
+    <VersionPrefix>$(CliVersionPrefix)</VersionPrefix>
     <TargetFramework>$(ToolsetTargetFramework)</TargetFramework>
+    <RuntimeFrameworkVersion>3.0.0-preview1-27023-03</RuntimeFrameworkVersion>
     <GenerateRuntimeConfigurationFiles>false</GenerateRuntimeConfigurationFiles>
     <CopyBuildOutputToPublishDirectory>false</CopyBuildOutputToPublishDirectory>
   </PropertyGroup>
@@ -9,4 +11,4 @@
   <ItemGroup>
     <PackageReference Include="NuGet.CommandLine.XPlat" Version="$(NuGetCommandLineXPlatPackageVersion)" />
   </ItemGroup>
-</Project>
\ No newline at end of file
+</Project>
-- 
2.18.0

